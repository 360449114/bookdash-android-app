machine:
   environment:
     ANDROID_HOME: /usr/local/android-sdk-linux

dependencies:
  cache_directories:
      - ~/.android
        - ~/android
  pre:
    - touch app/google-services.json
    - echo $GOOGLE_SERVICES_JSON > app/google-services.json
    - echo y | android update sdk --no-ui --all --filter "tools,platform-tools,android-23"
    - echo y | android update sdk --no-ui --all --filter "build-tools-23.0.2"
    - (source scripts/environmentSetup.sh && getAndroidSDK)

test:
  pre:
        - $ANDROID_HOME/tools/emulator -avd testAVD -no-skin -no-audio -no-window:
          background: true
        - (./gradlew assembleDebug):
          timeout: 1200
        - (./gradlew assembleDebugTest):
          timeout: 1200
        - (source scripts/environmentSetup.sh && waitForAVD)

  override:
    - (echo "Running JUnit tests!")
      - (./gradlew connectedAndroidTest)
      - ./gradlew assembleDebug
      - cp -r app/build/outputs $CIRCLE_ARTIFACTS
      - cp -r app/build/test-results/mockDebug $CIRCLE_ARTIFACTS
      - cp -r app/build/test-results/prodDebug $CIRCLE_ARTIFACTS